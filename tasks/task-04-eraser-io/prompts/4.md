Для реализации фичи необходимо решить несколько задач:

1. Получение цен на комбо из Databricks (сервис Персонализации):

  1. обычная интеграция с Databricks для получения данных

  2. конечная точка в сервисе персонализации для предоставления данных по ценам комбо другим сервисам

2. Отображение цен на комбо в меню мобильных приложений (MAPI + iOS/Android)

  Возникли обсуждения по поводу способа передачи цен в мобильные приложения. Рассматривались два подхода: отдельная конечная точка и интеграция через стейт. Было принято решение использовать стейт по аналогии с персональными ценами.

  1. при получении стейта запрашиваем динамические цены комбо из персонализации и сохраняем в стейт

  2. возвращаем цены комбо на мобильные приложения в модели стейта

3. При расчете стоимости заказа использовать динамические цены комбо (LF + OrderCalculator)

  1. из МАПИ при запросе на расчет заказа отправляем цены комбо в LF

  Рассматривались два подхода: передавать из МАПИ цены или в LF их подгружать отдельно. В первой итерации передаем из МАПИ в LF, так как это быстрее, чтобы проверить гипотезу

  2. LF передает дальше в OrderCalculator цены комбо

  3. OrderCalculator использует динамические цены комбо вместо обычных (из МАПИ в LF уже можно передать цену на комбо, которую LF передаст в расчетчик, поэтому просто можно сделать одно изменение в МАПИ)

iOS/Android
1. Запрашивает стейт
MAPI
2. Запрашивает данные по динамической стоимости комбо
Personalization
3. Запрашивает данные по динамической стоимости комбо
ML
4. Возвращает рекомендуемую цену комбо
Personalization
5. Возвращает рекомендуемую цену комбо
MAPI
6. Передает в запросе на расчет заказа информацию по рекомендуемой цене на комбо
LF
7.  Передает в запросе на расчет заказа информацию по рекомендуемой цене на комбо
OrderCalculator
8. Возвращает посчитанный заказ c учетом динамических цен на комбо
LF
9. Возвращает посчитанный заказ c учетом динамических цен на комбо
MAPI
10. Возвращает стейт. В стейте есть все рекомендуемые цены на комбо. И посчитанная корзина с учетом рекомендуемых цен на комбо.
