# Резюме
# Мотивация, задача
Для кофеен Дринкита сейчас нет возможности задать выходные. Много кофеен не работают в субботу, воскресенье. Из-за этого приходится задавать время работы кофейни с 00:00 по 00:30 в выходные. Так как расписание потом тянется в карты, карты приходится править руками. Эти правки периодически слетают. С ростом числа кофеен становится всё сложнее.
# Описание
**Предлагаю реализовать с тоглом только для Дринкит.**
В додоис нет возможности задавать выходные. Если у кофейни выходной, то для неё задается время работы с 00:00 до 00:30.
У пиццерии/кофейни в додоис есть поле - `StationaryWeekWorkTime`. Это время работы ресторана. Поле - массив из `TimePeriod`:
```Plain Text
public DayOfWeek DayOfWeek { get; set; }
public TimeSpan BeginTime { get; set; }
public TimeSpan EndTime { get; set; }
```
Сейчас везде захардкожены 7 дней недели для `StationaryWeekWorkTime` (и есть валидации на то, что в массиве строго 7 элементов).
Экран настройки сейчас выглядит так (ЦА → Подразделения → В карточке подразделения таб Пиццерии → Открыть любую пиццерию на редактирование):
### Решение
Предлагаю реализовать выбор рабочих дней. В `TimePeriod` добавляем поле `IsDayOff`:

```Plain Text
public DayOfWeek DayOfWeek { get; set; }
public TimeSpan BeginTime { get; set; }
public TimeSpan EndTime { get; set; }
public bool IsDayOff { get; set; }
```
При этом время работы будет автоматически выставляться `00:00-00:30`, как это делается сейчас для выходных. Таким образом, для сервисов-потребителей ничего не меняется.
В додоис появляются чекбоксы. По-умолчанию они все выбраны. Если какой-то чекбокс не выбран, то инпут с часами работы очищается и блокируется - это нерабочий день. Аналогичные чекбосы появятся для вариантов "Круглостучно", "Одно и то же время".
Важно не забыть про выравнивание чекбоксов во время реализации (по горизонтали по часам, по вертикале - отступ аналогично между другими чекбоксами и текстом).
Здесь есть один недостаток.
В UI у нас используется флаг, который равен true, если день рабочий. А в коде флаг, который true, если день - нерабочий.
Но в UI так сделано для удобства пользователя, а в коде так, чтобы добавление нового поля не ломало существующие контракты. Дефолтное значение bool - false, то есть по дефолту у нас все дни будут рабочие, как и раньше.
#### Отображение только для Дринкит
В датакаталоге управляем тем, можно ли задавать выходные.
Для потребителей данных из дата каталога: если можно - отправляем новое поле, если нет - оно остается не заполненным.
Для фронта карточки редактирования пиццерии в додоис, который обращается к датакаталогу, датакаталог в клиентской модели Store возвращает признак DayOfEnabled. Если он true, ренедрим новый ui, иначе - старый. Так у нас вся логика хранится в датакаталоге.
Отображать выходные или нет датакаталог решает в зависимости от того дринкит ли это кофейня
### Зависимые системы
Сейчас выходные нужны только в Дринкит. Предлагаю реализовывать с тоглом только для дринкит. И только для датакаталога, додоис и placed-feeds-drinkit.
Так как в случае выбора выходных будет автоматически устанавливаться время работы с 00:00 до 00:30, как это делается сейчас, для клиентов ничего не изменится и обновлять их нет необходимости.
Для реализации в додоис надо доработать зависимые системы.
#### datacatalog (нужно для управление новым полем)
 1. Добавить новое поле `IsDayOff` в `TimePeriod`
1. Добавить поле в `ChangeDeliveryWorkTimePeriodRequest`
2. Обновить логику объединения времени работы в `ChangeDeliveryWorkTimeHandler`
3. Учесть поле в `UpdateWorkTimeValidator`
4. Добавить новое поле `DayOfEnabled` для передачи клиенту в `/DataCatalog/api/v1/Stores/`
#### department-unit-microfrontends (нужно, чтобы добавить новый ui)
5. Добавить новое поле в `ScheduleObject`
6. Добавить компоненты аналогичные `Schedule` для всех трех режимов работы пиццерии
7. Обновить логику отправку конвертирования в модель для бэка `mapDifferentTimeSchedule`
#### dodo-is (нужно для отображения нового поля)
8. Добавить новое поле `IsDayOff` в `TimePeriod` 
9. Обновить формирование `WeeklySchedule` (влияет на отображение расписания в додоис)
10. Обновить получение данных из датакаталога в `PizzeriasParametersTypeHandler`
11. Обновить схему в `src/Dodo.Api/Dodo.Api.Web/specification/reference/dodo-is-api.yaml`
12. Добавить отображение новой настройки в деталке пиццерии - `src/Dodo.Admin/Dodo.Admin.Web/Areas/DepartmentsStructure/Views/Pizzerias/Details.cshtml`
13. Обновить `ChangeDeliveryWorkTimePeriodRequest` и его маппинг в `DepartmentsSettingsController`
14. Обновить проверку время работы пиццерии при размещении заказа в `PizzeriaScheduleValidator`
#### drinkit-mobile-api (нужно для отображения выходных в приложении)
15. Добавить новое поле `IsDayOff` в `TimePeriod` 
16. Учесть новое поле в `UnitMapper`
#### placed-feeds-drinkit (нужно, чтобы выходной подтянулся на карты)
17. Добавить учет поля `IsDayOff` при получении данных из publicapi
